define("funnel-bundle",[],function(){var d=function(l,x){var p,m=undefined,w=undefined,v=150,o=d3.scale.category20().range().concat(d3.scale.category20b().range()).concat(d3.scale.category20c().range()),u=["square"],t=d3.dispatch("initialized","startToInit");var r=$.extend(true,{},l.props(null));var n;var s=x.effectManager;function q(y){t.startToInit();n=y;y.each(function(){var A=p.getAnalysisAxisDataByIdx(0);var am=A.values[0].col.val;var Q=p.getMeasureValuesGroupDataByIdx(0);var ak=Q.values[0].col;var aj=Q.values[0].rows[0];var aa=[];var ao=[];for(var av=0;av<aj.length;av++){var C=[];var af={};af.val=A.values[0].rows[av].val;af.color=o[av%(o.length>aj.length?aj.length:o.length)];af.ctx=aj[av].ctx;aa.push(af);ao.push(aj[av].val)}var at=[30,10,10,10],ap=m-at[1]-at[3],ax=w-at[0]-at[2];ap=ap<=0?1:ap;ax=ax<=0?1:ax;d3.select(this).selectAll("*").remove();var G=d3.select(this).append("svg:svg").attr("overflow","visible").attr("width",m).attr("height",w+v).append("svg:g").attr("transform","translate("+at[3]+","+at[0]+")");var E=function(aF,aG,aE){if(aF&&aE){var aH=aF.append("g").classed("v-datalabel",true).attr("transform","translate("+0+","+aG+")");aH.append("text").text(ac(aE)).style("pointer-events","none")}};var ah=ax,D=(60/100)*ap;var J=new Array();var au=(ap-D)/2;var F=0;for(var av=0;av<ao.length;av++){F=F+ao[av]}for(var av=0;av<ao.length;av++){J[av]=(ao[av]/F)*100}var an=new Array();var az=new Array();an[0]=0;for(var aw=1;aw<=J.length;aw++){an[aw]=(J[aw-1]/100)*ah}az[0]=0;for(var aw=1;aw<=J.length;aw++){az[aw]=(an[aw]*D)/(2*ah)}var I;var H;var W;var P,V,O,U,N,T,M,S;var al,ae,X,L;var aq=ah-an[an.length-1];var ad=az[az.length-1];var K;var ab;if(r&&r.datalabel&&r.datalabel.visible===true){ab=y.append("g").classed("v-m-datalabel",true).attr("transform","translate("+(au+D/2)+","+30+")").attr("fill",r.datalabel.style.color).attr("font-family",r.datalabel.style.fontFamily).attr("font-size",r.datalabel.style.fontSize).attr("font-weight",r.datalabel.style.fontWeight).attr("font-style",r.datalabel.style.fontStyle)}for(var aw=az.length-1;aw>0;aw--){H=(15/100)*an[aw];if(H>15){H=15}W=(H*D)/(2*ah);P=au+(D/2)-ad;V=aq;O=au+(D/2)+ad;U=V;var ag=aa[aw-1].color;var ay=G.append("svg:g");I=((30*2)/D)*((ad-az[aw])+W);T=aq+an[aw]-H;N=au+(D/2)+(ad-az[aw])+W;M=au+(D/2)-(ad-az[aw])-W;fillId=function(){var aE={drawingEffect:r.drawingEffect,fillColor:ag,direction:"vertical"};return s.register(aE)};var aC=ay.append("svg:ellipse").classed("v-datapoint",true).attr("cx",au+D/2).attr("cy",T).attr("rx",(ad-az[aw])+W).attr("ry",I).attr("fill",fillId);var ai=T+I;S=T;al=P+","+V;ae=O+","+U;X=N+","+T;L=M+","+S;var Y=ay.append("svg:polygon").classed("v-datapoint",true).attr("id","polygontool").attr("points",al.toString()+" "+ae.toString()+" "+X.toString()+" "+L.toString()).attr("fill",fillId);I=((30*2)/D)*(ad);var B=ay.append("svg:ellipse").classed("v-datapoint",true).attr("cx",au+D/2).attr("cy",aq).attr("rx",ad).attr("ry",I).attr("fill",fillId);ai=(ai+aq)/2;var z=sap.viz.api.env.Format,ar=sap.common.globalization.NumericFormatManager.DEFAULT_FORMAT_NUMBER;var R=function(aF){var aE="";if(r.tooltip.formatString&&r.tooltip.formatString.length>0){aE=r.tooltip.formatString[0]}else{aE=ar}return z.format(aF,aE)};var ac=function(aF){var aE="";if(r.datalabel.formatString&&r.datalabel.formatString.length>0){aE=r.datalabel.formatString[0]}return z.formatToText(aF,aE,true)};var aD=function(aJ){var aF=parseInt(aJ.x);var aL=parseInt(aJ.y);var aE=50;var aI=aJ.dimToolTipText.length*8+10;var aG=aJ.mesToolTipText.length*8+10;var aH=aI>aG?aI:aG;var aK=G.append("g").attr("id","tooltip").attr("overflow","visible");aK.append("path").attr("id","tipPath").style("fill","#F4F4F4").attr("d","M"+(aF+5)+" "+(aL)+"H"+(aF+aH)+"V"+(aL+aE)+"H"+(aF+10)+"V"+(aL+5)+"Z");aK.append("text").attr("id","#tipDimension").attr("x",aF+15).attr("y",aL+20).attr("font-size","13"+"px").attr("font-family","Arial").text(aJ.dimToolTipText);aK.append("text").attr("id","tipMeasure").text(aJ.mesToolTipText).attr("x",aF+20).attr("y",aL+37).attr("font-size","13"+"px").attr("font-family","Arial");d3.select("#tipPath").attr("d","M"+(aF+5)+" "+(aL)+"H"+(aF+aH)+"V"+(aL+aE)+"H"+(aF+10)+"V"+(aL+5)+"Z");d3.select("#tipDimension").attr("x",aF+15).attr("y",aL+20);d3.select("#tipMeasure").attr("x",aF+20).attr("y",aL+37)};var aA=function(aE){for(var aF=0;aF<aa.length;aF++){if(aa[aF].ctx.path.dii_a1===aE){return(aF+1)}}};var Z=function(aH,aF){var aI=am+" : "+aa[aF-1].val;var aE=ak+" : "+R(ao[aF-1])+" ("+R(J[aF-1])+"%)";var aG={"x":d3.mouse(aH)[0],"y":d3.mouse(aH)[1],"dimToolTipText":aI,"mesToolTipText":aE};return aG};if(r.tooltip.visible){aC.on("mouseover",function(aF){var aE=aA(aF.ctx.path.dii_a1);aD(Z(this,aE))});aC.on("mouseout",function(){G.select("#tooltip").remove()});Y.on("mouseover",function(aF){var aE=aA(aF.ctx.path.dii_a1);aD(Z(this,aE))});Y.on("mouseout",function(){G.select("#tooltip").remove()});B.on("mouseover",function(aF){var aE=aA(aF.ctx.path.dii_a1);aD(Z(this,aE))});B.on("mouseout",function(){G.select("#tooltip").remove()})}for(var aB=0;aB<ay[0][0].childNodes.length;aB++){ay[0][0].childNodes[aB].__data__={};ay[0][0].childNodes[aB].__data__.ctx=aa[aw-1].ctx}E(ab,ai,ao[aw-1]);aq=aq-an[aw-1];ad=ad+az[aw-1]}b(y,m,w,undefined,true);t.initialized({name:"initialized"})});return q}q.dispatch=function(y){if(!arguments.length){return t}t=y;return q};q.parent=function(){return n};q.highlight=function(y,B){if(!y.length){y=[y]}var C=[];for(var A=0;A<y.length;A++){for(var z=0;z<y[A].parentNode.childNodes.length;z++){if(y.indexOf(y[A].parentNode.childNodes[z])==-1){C.push(y[A].parentNode.childNodes[z])}}}for(var A=0;A<C.length;A++){y.push(C[A])}if(!B){d3.selectAll(y).attr("opacity",1)}};q.unhighlight=function(y){if(!y.length){y=[y]}var B=[];for(var A=0;A<y.length;A++){if(y[A].parentNode!=undefined&&y[A].parentNode!=null){if(y[A].parentNode.childNodes!=undefined&&y[A].parentNode.childNodes!=null){for(var z=0;z<y[A].parentNode.childNodes.length;z++){if(y.indexOf(y[A].parentNode.childNodes[z])==-1){B.push(y[A].parentNode.childNodes[z])}}}}}for(var A=0;A<B.length;A++){y.push(B[A])}};q.clear=function(y){if(y===undefined||y===false){n.selectAll(".v-datapoint").attr("opacity",1)}else{n.selectAll(".v-datapoint").attr("opacity",0.4)}};q.width=function(y){if(!arguments.length){return m}m=y;return q};q.height=function(y){if(!arguments.length){return w}w=y;return q};q.data=function(y){if(!arguments.length){return p}p=y;return q};q.properties=function(y){if(!arguments.length){return r}r=$.extend(r,y);if(y&&y.colorPalette){o=y.colorPalette}return q};q.colorPalette=function(y){if(!arguments.length){return o}o=y;return this};q.hideTitle=function(){hideTitle=true;return q};q.hide=function(y){isHidden=y;return q};q.effectManager=function(y){if(!arguments.length){return s}s=y;return q};return q};var b=function(p,o,l,n,r){var s="v-bound";var q;if(o<0||l<0){return null}if(p.select("."+s).node()==null){q=p.insert("rect",":first-child").attr("class",s).attr("width",o).attr("height",l);if(r){q.attr("fill","transparent")}else{q.attr("visibility","hidden")}}else{q=p.select("."+s).attr("width",o).attr("height",l)}if(n){for(var m in n){if(n.hasOwnProperty(m)){q.attr(m,n[m])}}}return q};var f={"id":"sap.viz.modules.funnel.valueaxis1","name":"Primary Values","type":"Measure","min":1,"max":1,"mgIndex":1};var i={"id":"sap.viz.modules.funnel.series.color","name":"Category","type":"Dimension","min":1,"max":1,"maxStackedDims":1,"acceptMND":false,"aaIndex":1};var j=d3.scale.category20().range().concat(d3.scale.category20b().range()).concat(d3.scale.category20c().range());var a={"id":"sap.viz.modules.funnel","type":"CHART","name":"funnel Chart","datastructure":"DATA STRUCTURE DOC","properties":{"tooltip":{"name":"tooltip","description":"Settings for tooltip","supportedValueType":"Object","supportedValues":{"visible":{"name":"visible","supportedValueType":"Boolean","defaultValue":true,"description":"Set the visibility of tooltip"},"formatString":{"name":"formatString","supportedValueType":"StringArray","defaultValue":null,"description":"Set format string of tooltip"}}},"colorPalette":{"name":"colorPalette","supportedValueType":"StringArray","description":"set color palette for the chart","defaultValue":j},"datalabel":{"name":"datalabel","supportedValueType":"Object","description":"set property for datalabel","supportedValues":{"visible":{"name":"visible","supportedValueType":"Boolean","defaultValue":false,"description":"Set whether the data labels are visible",},"formatString":{"name":"formatString","supportedValueType":"StringArray","defaultValue":null,"description":"Set format string of datalabel"},"style":{"name":"style","description":"Settings for datalabel style.","supportedValueType":"Object","supportedValues":{"color":{"name":"color","supportedValueType":"String","defaultValue":"#333333","description":"Set color of datalabel."},"fontFamily":{"name":"fontFamily","supportedValueType":"String","defaultValue":"'Open Sans', Arial, Helvetica, sans-serif","description":"Set fontFamily of datalabel."},"fontSize":{"name":"fontSize","supportedValueType":"String","defaultValue":"12px","description":"Set fontSize of datalabel."},"fontWeight":{"name":"fontWeight","supportedValueType":"String","defaultValue":"normal","description":"Set fontWeight of datalabel."},"fontStyle":{"name":"fontStyle","supportedValueType":"String","defaultValue":"normal","description":"Set fontStyle of datalabel."}}}}}},"events":{},"feeds":[f,i],"css":null,"configure":null,"fn":d};var k=function(n,l){var o=function(){};var m=$.extend(true,{},n.props(null));o.data=function(w){var z=new Array();var r=w.getAnalysisAxisDataByIdx(0);var D=r.values[0].col.val;var B=w.getMeasureValuesGroupDataByIdx(0);var y=B.values[0].col;var q=B.values[0].rows[0];for(var t=0;t<q.length;t++){var v=[];var p={};var s={};p.val=r.values[0].rows[t].val;p.ctx=r.values[0].rows[t].ctx;v.push(p);var x=Number(q[t].val);if(isNaN(x)){x=0}s.val=x;s.ctx=q[t].ctx;v.push(s);z.push(v)}z.sort(function(F,E){return E[1].val-F[1].val});if(z.length>30){z=z.splice(0,30)}var A=new Array();var C=new Array();for(var u=0;u<z.length;u++){A.push(z[u][0]);C.push(z[u][1])}w.getAnalysisAxisDataByIdx(0).values[0].rows=A;w.getMeasureValuesGroupDataByIdx(0).values[0].rows[0]=C};o.properties=function(p){if(!arguments.length){return m}m=$.extend(m,p);return o};return o};var h={"id":"sap.viz.modules.funnelDataTranform","type":"CONTROLLER","name":"funnel chart data transfrom","renderto":"NONE","datastructure":"","properties":{},"events":{"initialized":"initialized",},"css":null,"configure":null,"fn":k};var g={id:"viz/ext/pa/funnel",name:"Funnel Chart",legacyDataAdapter:true,modules:{dataTransform:{id:"sap.viz.modules.funnelDataTranform",configure:{propertyCategory:"dataTransform"}},root:{id:"sap.viz.modules.rootContainer",configure:{propertyCategory:"general"},modules:{interaction:{id:"sap.viz.modules.controller.interaction",configure:{clientID:"main",propertyCategory:"interaction",properties:{holdSelection:true}}},layout:{id:"sap.viz.modules.layout.dock"},title:{id:"sap.viz.modules.title",configure:{propertyCategory:"title",properties:{layout:{position:"top",priority:0}}}},legends:{id:"sap.viz.modules.legend",configure:{propertyCategory:"legendContainer",properties:{layout:{position:"right",priority:1}}},modules:{legend:{id:"sap.viz.modules.legend.common",data:{aa:[1]},configure:{propertyCategory:"legend",properties:{layout:{order:0}}}},layout:{id:"sap.viz.modules.layout.stack"}}},main:{id:"sap.viz.modules.xycontainer",modules:{plot:{id:"sap.viz.modules.funnel",configure:{propertyCategory:"plotArea",properties:{layout:{position:"top",priority:1},tooltip:{visible:true,formatString:null},datalabel:{visible:false,formatString:null,style:{color:"#333333",fontFamily:"'Open Sans', Arial, Helvetica, sans-serif",fontSize:"12px",fontWeight:"normal",fontStyle:"normal"}},colorPalette:j}}},background:{id:"sap.viz.modules.background",configure:{propertyCategory:"background",properties:{direction:"vertical"}}}},configure:{propertyCategory:"xyContainer",properties:{layout:{position:"center",priority:5}}}}}}},dependencies:{attributes:[{targetModule:"root.legends.legend",target:"colorPalette",sourceModule:"root.main.plot",source:"colorPalette"}],events:[{targetModule:"root.interaction",listener:"initialize",sourceModule:"root.main.plot",type:"initialized.interaction"}]}};var c={viz:[g],module:[a,h],feeds:[]};var e=sap.bi.framework.declareBundle({"id":"viz.ext.pa.funnel","version":"1.0.0","components":[{"id":"viz/ext/pa/funnel","provide":"sap.viz.impls","instance":c,"customProperties":{"name":"localize!COMPONENT_NAME","description":"A funnel chart shows the stack relation of data","icon":{"path":""},"category":["predictive","comparision"],"resources":[{"key":"sap.viz.api.env.Template.loadPaths","path":"./resources/templates"}],"requires":[{"id":"sap.viz.common.core","version":"4.0.12"}]}}],"localizedResources":{"en":{"THE_COMPONENT_NAME":"en"},"fr":{"THE_COMPONENT_NAME":"fr"},"zh-CN":{"THE_COMPONENT_NAME":"zh_CN"},"de":{"THE_COMPONENT_NAME":"de"},"ja":{"THE_COMPONENT_NAME":"ja"},"es":{"THE_COMPONENT_NAME":"es"},"ru":{"THE_COMPONENT_NAME":"ru"},"pt":{"THE_COMPONENT_NAME":"pt"},"ko":{"THE_COMPONENT_NAME":"ko"}}});if(sap.bi.framework.getService("sap.viz.aio","sap.viz.extapi")){return sap.bi.framework.getService("sap.viz.aio","sap.viz.extapi").core.registerBundle(e)}else{return e}});